<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Icon Forge Dashboard</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: #f5f5f5;
      }
      h2 {
        margin-top: 40px;
      }
      .section {
        background: #fff;
        padding: 20px;
        margin-bottom: 20px;
        border-radius: 8px;
        box-shadow: 0 0 5px #ccc;
      }
      button {
        margin: 5px;
        padding: 10px 15px;
      }
      .output {
        margin-top: 10px;
        font-weight: bold;
      }
      .list {
        margin-top: 10px;
        font-family: monospace;
        background: #eee;
        padding: 10px;
        border-radius: 6px;
      }
    </style>
    <script>
      let dashboard = {};

      async function loadDashboard() {
        const response = await fetch("php/load_dashboard.php");
        dashboard = await response.json();
        renderDashboard();
      }

      function renderDashboard() {
        document.getElementById("theme-output").innerText =
          dashboard.generated_theme?.name || "DISPLAY THEME GENERATED HERE";
        document.getElementById("theme-new-flag").innerText =
          "IS NEW: " + (dashboard.generated_theme?.is_new ?? "[TRUE/FALSE]");
        document.getElementById("theme-backlog").innerText =
          "Theme Backlog: " + dashboard.theme_backlog.join(", ");

        document.getElementById("selected-theme").innerText =
          dashboard.selected_theme || "DISPLAY SELECTED THEME HERE";
        document.getElementById("icon-idea").innerText =
          dashboard.generated_icon_idea?.idea ||
          "DISPLAY GENERATED ICON IDEA HERE";
        document.getElementById("icon-new-flag").innerText =
          "IS NEW: " +
          (dashboard.generated_icon_idea?.is_new ?? "[TRUE/FALSE]");
        document.getElementById("icon-backlog").innerText =
          "Icon Backlog: " +
          dashboard.icon_idea_backlog.map((i) => i.idea).join(", ");

        document.getElementById("grabbed-icon").innerText =
          "Selected Icon: " +
          (dashboard.selected_icon?.idea ?? "[Grabbed icon name]");
        document.getElementById("icon-preview").innerText =
          "DISPLAY GENERATED ICON HERE";
        document.getElementById("png-quality").innerText =
          "IS QUALITY (PNG): " +
          (dashboard.generated_icon?.quality_check_passed ?? "[TRUE/FALSE]");

        document.getElementById("vector-preview").innerText =
          "DISPLAY VECTOR ICON HERE";
        document.getElementById("svg-quality").innerText =
          "IS QUALITY (SVG): " +
          (dashboard.vectorized_icon?.quality_check_passed ?? "[TRUE/FALSE]");

        const md = dashboard.metadata;
        document.getElementById("metadata-view").innerText = md
          ? `Name: ${md.name}\nDesc: ${
              md.short_description
            }\nTags: ${md.tags.join(", ")}`
          : "DISPLAY AND EDIT METADATA HERE";
      }

      async function saveDashboard() {
        await fetch("php/save_dashboard.php", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(dashboard),
        });
      }

      async function generateTheme() {
        const response = await fetch("php/generate_theme.php", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            theme_backlog: dashboard.theme_backlog,
            themes_used: dashboard.completed_themes,
          }),
        });

        const data = await response.json();
        dashboard.generated_theme = {
          name: data.theme,
          is_new: data.is_new,
        };

        console.log("[Replicate Response]", data); // ðŸ‘ˆ Add this line

        renderDashboard();
        saveDashboard();
      }

      function addThemeToBacklog() {
        if (
          dashboard.generated_theme?.name &&
          dashboard.generated_theme.is_new
        ) {
          dashboard.theme_backlog.push(dashboard.generated_theme.name);
          dashboard.generated_theme.is_new = false;
          renderDashboard();
          saveDashboard();
        }
      }

      function grabTopBacklogTheme() {
        if (dashboard.theme_backlog.length > 0) {
          dashboard.selected_theme = dashboard.theme_backlog.shift();
          renderDashboard();
          saveDashboard();
        }
      }

      async function generateIconIdea() {
        if (!dashboard.selected_theme) return;

        const existingIdeas = dashboard.icon_idea_backlog
          .filter((i) => i.theme === dashboard.selected_theme)
          .map((i) => i.idea);

        const response = await fetch("php/generate_icon_idea.php", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            selected_theme: dashboard.selected_theme,
            existing_ideas: existingIdeas,
          }),
        });

        const data = await response.json();
        dashboard.generated_icon_idea = {
          idea: data.idea,
          is_new: data.is_new,
        };

        renderDashboard();
        saveDashboard();
      }

      function addIconIdea() {
        if (
          dashboard.generated_icon_idea?.idea &&
          dashboard.generated_icon_idea.is_new
        ) {
          dashboard.icon_idea_backlog.push({
            theme: dashboard.selected_theme,
            idea: dashboard.generated_icon_idea.idea,
          });
          dashboard.generated_icon_idea.is_new = false;
          renderDashboard();
          saveDashboard();
        }
      }

      function grabTopIcon() {
        if (dashboard.icon_idea_backlog.length > 0) {
          dashboard.selected_icon = dashboard.icon_idea_backlog.shift();
          renderDashboard();
          saveDashboard();
        }
      }

      async function generateIcon() {
        console.log("test bug");
        const { theme, idea } = dashboard.selected_icon;
        const response = await fetch("php/generate_icon.php", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ theme, idea }),
        });

        const data = await response.json();
        dashboard.generated_icon = {
          png_path: data.png_path,
          quality_check_passed: false,
        };

        console.log("ðŸ“¦ RESPONSE FROM PHP:", data);

        renderDashboard();
        saveDashboard();
      }

      window.onload = loadDashboard;
    </script>
  </head>
  <body>
    <h1>Icon Forge Dashboard</h1>

    <div class="section">
      <h2>Action 1: Generate Theme</h2>
      <button onclick="generateTheme()">[GENERATE NEW THEME]</button>
      <button onclick="addThemeToBacklog()">[ADD THEME TO BACKLOG]</button>
      <div class="output" id="theme-output">DISPLAY THEME GENERATED HERE</div>
      <div class="output" id="theme-new-flag">IS NEW: [TRUE/FALSE]</div>
      <div class="list" id="theme-backlog">
        Theme Backlog: [List of themes here]
      </div>
    </div>

    <div class="section">
      <h2>Action 2: Generate Icon Idea</h2>
      <button onclick="grabTopBacklogTheme()">[GRAB TOP BACKLOG THEME]</button>
      <button onclick="generateIconIdea()">[GENERATE ICON IDEA]</button>
      <button onclick="addIconIdea()">[ADD ICON IDEA TO ICON BACKLOG]</button>
      <div class="output" id="selected-theme">DISPLAY SELECTED THEME HERE</div>
      <div class="output" id="icon-idea">DISPLAY GENERATED ICON IDEA HERE</div>
      <div class="output" id="icon-new-flag">IS NEW: [TRUE/FALSE]</div>
      <div class="list" id="icon-backlog">
        Icon Backlog: [List of icon ideas here]
      </div>
    </div>

    <div class="section">
      <h2>Action 3: Generate Icon</h2>
      <button onclick="grabTopIcon()">[GRAB TOP BACKLOG ICON]</button>
      <button onclick="generateIcon()">[GENERATE ICON]</button>
      <div class="output" id="grabbed-icon">
        Selected Icon: [Grabbed icon name]
      </div>
      <div class="output" id="icon-preview">DISPLAY GENERATED ICON HERE</div>
      <div class="output" id="png-quality">IS QUALITY (PNG): [TRUE/FALSE]</div>
    </div>

    <div class="section">
      <h2>Action 4: Vectorize Icon</h2>
      <button onclick="/* vectorizeIcon logic here */">[VECTORIZE ICON]</button>
      <button onclick="/* saveVector logic here */">[SAVE VECTOR]</button>
      <div class="output" id="vector-preview">DISPLAY VECTOR ICON HERE</div>
      <div class="output" id="svg-quality">IS QUALITY (SVG): [TRUE/FALSE]</div>
    </div>

    <div class="section">
      <h2>Action 5: Finalize Metadata</h2>
      <button onclick="/* generateMetadata logic here */">
        [GENERATE METADATA]
      </button>
      <button onclick="/* saveMetadata logic here */">[SAVE METADATA]</button>
      <div class="output" id="metadata-view">
        DISPLAY AND EDIT METADATA HERE
      </div>
    </div>
  </body>
</html>
