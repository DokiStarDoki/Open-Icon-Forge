<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Batch PNG to SVG Converter</title>
    <style>
      body {
        font-family: sans-serif;
        padding: 2rem;
        background: #f0f0f0;
      }
      .status {
        margin-top: 1rem;
        background: #fff;
        padding: 1rem;
        border-radius: 8px;
      }
      .file-item {
        margin-bottom: 0.5rem;
      }
    </style>
  </head>
  <body>
    <h1>Batch Vectorization</h1>
    <button onclick="startBatch()">Convert All PNG/WEBP in /icons</button>
    <div class="status" id="status">Status: Idle</div>

    <script>
      async function listIncomingFiles() {
        const res = await fetch("php/list_pngs.php"); // You already have this in your dashboard
        return await res.json();
      }

      async function convertImage(imagePath) {
        const statusBox = document.getElementById("status");
        try {
          statusBox.innerHTML += `<div class="file-item">üñºÔ∏è Processing ${imagePath}...</div>`;

          // 1. PNG/WEBP ‚Üí BMP
          const bmpRes = await fetch("php/icon_to_bmp.php", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ image_path: imagePath }),
          });
          const bmpJson = await bmpRes.json();
          if (!bmpJson.success)
            throw new Error("BMP step failed: " + bmpJson.error);

          // 2. BMP ‚Üí SVG
          const svgRes = await fetch("php/bmp_to_svg.php", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ bmp_path: bmpJson.bmp_path }),
          });
          const svgJson = await svgRes.json();
          if (!svgJson.success)
            throw new Error("SVG step failed: " + svgJson.error);

          statusBox.innerHTML += `<div class="file-item">‚úÖ ${imagePath} ‚Üí ${svgJson.svg_path}</div>`;
        } catch (e) {
          statusBox.innerHTML += `<div class="file-item" style="color: red;">‚ùå Error on ${imagePath}: ${e.message}</div>`;
        }
      }

      async function startBatch() {
        document.getElementById("status").innerHTML =
          "‚è≥ Starting conversion...";
        const files = await listIncomingFiles();
        for (const f of files) {
          await convertImage("input/" + f);
        }
        document.getElementById("status").innerHTML += "<hr>‚úÖ Done.";
      }
    </script>
  </body>
</html>
